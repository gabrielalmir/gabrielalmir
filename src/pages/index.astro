---
import Layout from "@/layouts/Layout.astro";
import { HomeClient } from "@/components/home-client";
import { getAllPosts } from "@/lib/blog";

const latestPosts = getAllPosts().slice(0, 3);
---

<Layout
  title="Gabriel Almir | Desenvolvedor Backend Node.js"
  preloadImage="/me.webp"
>
  <!-- Static above-fold content rendered as HTML for instant FCP -->
  <div
    class="min-h-screen bg-background text-foreground font-mono selection:bg-primary selection:text-black overflow-x-hidden"
    id="app-shell"
  >
    <!-- Skeleton shown until HomeClient hydrates -->
    <div id="home-skeleton" class="w-full">
      <div
        class="py-24 md:py-32 lg:py-40 px-4 sm:px-6 lg:px-8 w-full max-w-full relative"
      >
        <div class="container mx-auto max-w-7xl w-full">
          <div
            class="grid lg:grid-cols-[1.5fr,1fr] gap-12 lg:gap-16 items-center w-full max-w-full"
          >
            <div
              class="space-y-6 md:space-y-8 w-full max-w-full overflow-hidden z-10"
            >
              <div
                class="inline-flex items-center gap-2 px-3 sm:px-4 py-2 rounded-full border border-vesper-orange/20 bg-vesper-orange/5 max-w-full"
              >
                <span
                  class="w-2 h-2 rounded-full bg-vesper-cyan animate-pulse flex-shrink-0"
                ></span>
                <span class="text-xs sm:text-sm text-vesper-cyan truncate">
                  Vou fazer você apaixonar por tecnologia
                </span>
              </div>
              <div class="space-y-3 md:space-y-4 w-full max-w-full">
                <h1
                  class="text-4xl sm:text-5xl md:text-6xl lg:text-7xl font-bold leading-tight break-words w-full tracking-tight"
                >
                  <span class="text-foreground">Olá, sou</span><br />
                  <span class="text-vesper-orange">Gabriel Almir</span>
                </h1>
                <div
                  class="text-xl sm:text-2xl md:text-3xl lg:text-4xl font-semibold text-vesper-cyan/90 break-words w-full h-[1.5em] flex items-center"
                >
                  Desenvolvedor Backend Node.js
                </div>
                <p
                  class="text-base sm:text-lg md:text-xl text-foreground/70 max-w-2xl leading-relaxed break-words w-full mt-4"
                >
                  Gosto de resolver problemas com <span
                    class="text-vesper-orange">código limpo</span
                  > e <span class="text-vesper-orange">boas práticas</span>,
                  sempre aprendendo e evoluindo.
                </p>
              </div>
            </div>
            <div class="relative lg:justify-self-end group perspective-1000">
              <div
                class="absolute inset-0 bg-vesper-orange/20 rounded-2xl blur-[60px] opacity-40"
              >
              </div>
              <div class="relative w-full max-w-sm lg:max-w-md mx-auto">
                <div
                  class="aspect-square rounded-2xl overflow-hidden border border-vesper-orange/20 bg-black/40 backdrop-blur-sm relative"
                >
                  <div
                    class="absolute inset-0 bg-scanline opacity-10 z-10 pointer-events-none"
                  >
                  </div>
                  <img
                    src="/me.webp"
                    alt="Gabriel Almir - Desenvolvedor Backend Node.js"
                    width="400"
                    height="400"
                    class="w-full h-full object-cover image-balanced"
                    loading="eager"
                    fetchpriority="high"
                    decoding="async"
                  />
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- HomeClient hydrates when idle, replacing the skeleton -->
  <HomeClient client:idle latestPosts={latestPosts} />

  <script>
    // Hide skeleton once HomeClient mounts
    const skeleton = document.getElementById("home-skeleton");
    const appShell = document.getElementById("app-shell");
    const observer = new MutationObserver(() => {
      if (document.querySelector("[data-home-loaded]")) {
        if (skeleton) skeleton.style.display = "none";
        if (appShell) appShell.style.display = "none";
        observer.disconnect();
      }
    });
    observer.observe(document.body, { childList: true, subtree: true });
  </script>
</Layout>
